FROM python:3.10.19

RUN pip install --no-cache-dir fastapi uvicorn pillow onnxruntime
# Install ultralytics last - it will detect opencv-python-headless and not reinstall opencv-python
RUN pip install --no-cache-dir ultralytics
# remove the opencv-python if it was installed
RUN pip uninstall -y opencv-python || true
RUN pip install python-multipart

# Install opencv-python-headless first to avoid GUI dependencies
RUN pip install --no-cache-dir opencv-python-headless==4.10.0.84
# Install other dependencies - ultralytics will see opencv is already satisfied by opencv-python-headless
RUN pip install --no-cache-dir numpy==1.26.4

# install pyinstaller
RUN pip install --no-cache-dir pyinstaller

# Verify opencv installation (should show opencv-python-headless, not opencv-python)
RUN pip list | grep opencv

